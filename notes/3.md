# 3 ブログアプリの実装（後編）

2025-04-17

- start: 14:44
- 途中: 15:16
- start: 16:36
- 途中: 17:02

2025-04-18

- start: 08:56
- 途中: 12:00
- start: 13:00

## 3-1

CRUD機能にはどのようなものがあるか改めて確認しておきましょう。
DjangoにおいてCRUD機能を開発するには「URLパターン、ビュー、テンプレート」の開発が必要になる。
DjangoにおいてCRUD機能を開発するには「URLパターン、ビュー、テンプレート」の関係性をどのように定義するかあらかじめ設計する必要がある。

Djangoでは、テンプレートファイル内で静的ファイル(cssファイル等）を参照するために{% load static %}というコードを記述する必要があります。
これは頻繁に利用するコードですのでよく覚えておきましょう。

htmlの要素は外に出せる。
widgetsのside_category.htmlと、blog_list.htmlを参照

{% csrf_token %}と記載することでCSRF(Cross Site Request Forgeries)対策の設定を行っています。

CSRFとはセキュリティの脆弱性をついた攻撃のことで、訪問者のログイン情報を悪用してサイトに何らかの操作を行うことを目的としたリンクやフォームボタン、 JavaScript を設置した悪意のあるウェブサイトによって行われます。

また、関連する攻撃として、ユーザーを騙して別のユーザー権限でログインさせる ‘ログイン CSRF’ と呼ばれる攻撃もありますが、Djangoでは{% csrf_token %}と記載するだけでセキュリティ対策が施されます。
フォームでPOSTメソッドを指定する場合は必ずこのCSRF対策コードを追記するようにします。

Djangoでは汎用クラスビュー(DetailView)を使うと簡単に詳細画面を開発することができる。
詳細画面を開発するためには「URLパターンの定義、ビュー関数の定義、テンプレートの定義」の３つが必要。
詳細画面用のURLパターンでは<int:pk>を指定する。
DetailView(汎用クラスベースビュー）を使った場合、詳細画面のテンプレート側にはobjectという名称で該当データが渡される。
Djangoでは、テンプレートでURLの逆引き参照する際に{% url '名前空間名:URLパターン名称' 引数 %} のように引数を渡すことができる。

Djangoではhtml内でpythonのif文を利用することもできます。
以下の様に{% if 変数名 == "比較文字列" %}とすることでビューから渡って来た変数の中身をチェックして処理を分岐させることができます。

## 3-8

Djangoでは汎用クラスビュー(UpdateView)を使うと簡単に更新画面を開発することができる。
更新画面を開発するためには「フォームの定義、URLパターンの定義、ビュー関数の定義、テンプレートの定義」の4つが必要。
更新画面用のURLパターンでは<int:pk>を指定する。
Djangoでは、テンプレートでURLの逆引き参照する際に{% url '名前空間名:URLパターン名称' 引数 %} のように引数を渡すことができる、更新画面に遷移する際は引数にobject.pkを指定する。

## 3-9

Djangoでは汎用クラスビュー(DeleteView)を使うと簡単にデータの削除画面を開発することができる。
削除画面を開発するためには「URLパターンの定義、ビュー関数の定義、テンプレートの定義」の3つが必要。
削除画面用のURLパターンではint:pkを指定する。
Djangoでは、テンプレートでURLの逆引き参照する際に{% url '名前空間名:URLパターン名称' 引数 %} のように引数を渡すことができる、削除画面に遷移する際は引数にobject.pkを指定する。
汎用クラスビュー(DeleteView)を使うとデータ削除時の確認画面を簡単に実装することができる。

## 3-10

Djangoでは外部参照先の列名を指定する場合、アンダーバー２つ「__」をつけることで実現できます。

Blogクラスのcategory列はCategoryクラスを参照しているので、「category__category_name」と指定することで、外部参照しているCategoryクラスのcategory_nameを条件値として指定することができます。

画面上でクリックした文字列等でフィルタ検索したい場合、テンプレート上でURLの逆引き参照設定を行う。
逆引き参照設定する際に引数に検索文字列を指定するようにする（今回の例ではカテゴリ名を引数に指定）
URLパターンを'category/<str:category>/'のように設定することで特定の文字列にマッチするURLパターンを定義することができる。
get_querysetメソッドをオーバーライドすることでデータベースから取得するレコード条件を変更することができる。
Django クラスベースビューのメソッド内でURLのパラメータの情報を取得したい場合はself.kwargs['キーワード名']で取得することができる。
Djangoでは外部参照先の列名を指定する場合、アンダーバー２つ「__」をつける。

## 3-11

request.GETはdjangoでよく使われるメソッドです。

requestはHttpリクエスト(検索処理、登録処理等）が送信された際にDjangoが生成するオブジェクトです。

request.GETを実行することで、requestの情報を辞書型のデータで取得することができます。

そして、request.GET['フォームのname属性名']の様に指定することでフォーム画面上で入力した値等を取得することができます。

ただし、request.GETを使った場合に対象とするデータが存在しない場合エラーが発生してしまうため、Djangoでは通常request.GET.getを使います。

request.GET.getを使うと対象とするデータがない場合、Noneを返してくれるためエラーが発生しません。

request.GET.get('q', None)のように設定することでqパラメータの値(name=qの検索フォームに入力された文字列）を取得し、値が存在しない場合はNoneを取得します。

Qオブジェクトの利用方法は以下の通りです。

＜テーブルクラス名＞.objects.filter(Q(列名1__検索方法=条件値) | Q(列名2__検索方法=条件値))

Qを記載した後にかっこ()を書き、その中に検索対象のテーブルの列名と検索方法を指定します。

代表的な検索方法には以下のような種類があります。

項目	説明
exact	文字列が完全に一致する
contains	文字列の一部が一致する（大文字小文字区別有り）
icontains	文字列の一部が一致する（大文字小文字区別無し）
startswith	文字列が～で始まる
endswith	文字列が～で終わる

- 文字列検索機能を開発するためには「URLパターンの定義、ビュー関数の定義、テンプレートの定義」の3つが必要。
- 画面上で入力した文字列をビューで取得するにはrequest.GET.getメソッドを利用する。
- OR条件の検索を行いたい場合、Djangoが提供するQオブジェクトを利用する。
